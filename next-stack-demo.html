<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="css/reveal.css">
	<link rel="stylesheet" href="css/theme/black.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="lib/css/zenburn.css">

	<!-- Custom Theme -->
	<link rel="stylesheet" href="css/theme/iad.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section data-markdown data-notes="">
				<textarea data-template>
					 ### Présentation Nouvelle Stack
					 ## <img src="https://angular.schule/assets/img/angular.png" class="heartbeet"> <img src="https://hackr.io/tutorials/symfony/logo-symfony.svg?ver=1550189278" class="heartbeet">
					 mars 2019
				</textarea>
			</section>
			<section data-markdown>
				<textarea data-template>
          <div class="summary">
            <h2>1. IadNgxCore</h2>
            <p class="fragment fade-up">1.1 La gueule du bousin</p>
            <p class="fragment fade-up">1.2 Développement et publication</p>
            <p class="fragment fade-up">1.3 Classes (Composants, Services, Pipes, ...)</p>
            <p class="fragment fade-up">1.4 Redux</p>
            <p class="fragment fade-up">1.5 RxJS</p>
            <p class="fragment fade-up">1.6 Tests unitaires</p>
            <h2 class="fragment fade-up">2. IadNgxCss</h2>
            <h2 class="fragment fade-up"> 3. NextStackDemo</h2>
            <h2 class="fragment fade-up"> 4. Annexes</h2>
          </div>
        </textarea>
      </section>
      <section data-markdown>
        <textarea data-template>
          <h2>IadNgxCore</h2>
          <p>1.1 La gueule du bousin</p>
        </textarea>
      </section>
      <section data-markdown>
        <textarea data-template>
          <h3>C'est quoi du coup ?</h3>
          <p class="fragment fade-up">Librairie générée par <strong>Angular CLI</strong></p>
          <p class="fragment fade-up">Codée en Angular 7</p>
          <p class="fragment fade-up">Packagé au format <strong>APF</strong> à l'aide de la librairie <strong>ng-packagr</strong></p>
          <p class="fragment fade-up">Lien : https://www.iad-international.npme.io/package/@iad-international/iad-ngx-core</p>
        </textarea>
      </section>
      <section data-markdown>
        <textarea data-template>
          <h3>Composée de deux parties</h3>
          <p class="fragment fade-up">Projet de test : <strong>styleguide</strong></p>
          <p class="fragment fade-up">La librairie elle-même : <strong>core</strong></p>
          <p class="fragment fade-up">Bon, j'vous montre</p>
        </textarea>
      </section>
      <section data-markdown>
        <textarea data-template>
          <h2>IadNgxCore</h2>
          <p>1.2 Développement et publication</p>
        </textarea>
      </section>
			<section>
				<section data-markdown>
					<textarea data-template>
## Commandes de bases
```
// cloner le repo
git clone git@github.com:IAD-INTERNATIONAL/IadNgxCore.git

// installer des deps 
npm i 

// lancer les tests de la lib
npm run test OU ng test core

// lancer le linter
npm run lint OU ng lint

// réinstaller les deps et forcer le cache clean #HardCore
npm run reinstall

// lancer l'extraction des clés de traduction 
npm run translate-extract

// Developper sur le styleguide
npm run serve

// Developper sur le styleguide ET sur la librairie en watch mode
npm run dev

// Lancer le build (comporend le package) de la lib
npm run build

// Publier la librairie
npm run publish // PAS NPM PUBLISH
```
					</textarea>
				</section>
			</section>
			<section>
				<section data-markdown>
					<textarea data-template>
            <h3>Pour le dev</h3>
            <p class="fragment fade-up"><strong>npm run dev</strong> lancera le <strong>styleguide</strong> et le <strong>core</strong> en watch mode.</p>
            <p class="fragment fade-up"><strong>BUG :</strong> Quand un fichier de la lib changera, le styleguide buildera  3 fois. Ca sera corrigé dans un futur proche.</p>
          </textarea>
        </section>
        <section data-markdown>
            <textarea data-template>
              <h3>Pour la publication</h3>
              <p class="fragment fade-up"><strong>npm run publish</strong> lancera le build de la librairie et le packaging</p>
              <p class="fragment fade-up">Ne pas oublier d'upgrade la version du core avant de publier (dans tous les cas, npm vous enverra chier si c'est pas fait) </p>
            </textarea>
          </section>
			</section>
			<section>
				<section data-markdown>
					<textarea data-template>
						### 1.3 Classes, Composants, Services, Pipes
						- L'application styleguide-ngx présente les différents composants que vous pouvez réutiliser dans vos applications : 
						https://demo.iadholding.com/styleguide-ngx/styleguide
          </textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Composants actuellement disponibles
						- [Avatar](https://demo.iadholding.com/styleguide-ngx/styleguide/avatar)
						- [Xeditable](https://demo.iadholding.com/styleguide-ngx/styleguide/xeditable)
						- [CardList (css)](https://demo.iadholding.com/styleguide-ngx/styleguide/card-list)
						- [Dialog](https://demo.iadholding.com/styleguide-ngx/styleguide/dialog)
						- [Adresse Form (Refacto en cours)](https://demo.iadholding.com/styleguide-ngx/styleguide/address)
						- [Rating](https://demo.iadholding.com/styleguide-ngx/styleguide/rating)
						- [Phone input](https://demo.iadholding.com/styleguide-ngx/styleguide/phone-input)
						- [Geocode input](https://demo.iadholding.com/styleguide-ngx/styleguide/input-geocode)
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Composants actuellement disponibles
						- [Place input](https://demo.iadholding.com/styleguide-ngx/styleguide/place-input)
						- [Speed dial](https://demo.iadholding.com/styleguide-ngx/styleguide/speed-dial)
						- [Country autocomplete](https://demo.iadholding.com/styleguide-ngx/styleguide/country-autocomplete)
						- [Collaborator autocomplete](https://demo.iadholding.com/styleguide-ngx/styleguide/collaborators-autocomplete)
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Services actuellement disponibles
						- UrlService
						- AgentService
						- ApiService
						- AuthService
						- BreadcrumbService
						- CapacitationService				
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Services actuellement disponibles
						- CollaboratorsService
						- ConcessionService
						- GenealogyService
						- GeocodeService
						- IntroService
						- LocaleService
						- Menu Service
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Services actuellement disponibles
						- NotificationService
						- PeopleService
						- PoleService
						- RackSpaceService
						- ReferenceService
						- TopbarService
						- UtilService
						- WindowService
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Pipes actuellement disponibles
						- file-size
						- highlight
						- localized-date
						- ordinal
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Resolvers actuellement disponibles
						- CdiRedirectResolver
					</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
						### Custom validators
						- Les validators custom sont à ajouter dans la classe "CustomValidators". Actuellement seul la méthode validatePlace est présente.
					</textarea>
				</section>
			</section>
				<section data-markdown>
          <textarea data-template>
            <h2>IadNgxCore</h2>
            <p>1.5 RxJS</p>
          </textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
            <h3>Pour rappel</h3>
            <p class="fragment fade-up">Les <strong>Observables</strong> sont des flux</p>
            <p class="fragment fade-up">On s'y abonne...</p>
            <p class="fragment fade-up">ET ON S'Y DESABONNE !!!!</p>
            <p class="fragment fade-up">Quand vous allez vous coucher, vous laissez la télé allumée ?! NAN ! bah là c'est pareil !</p>
          </textarea>
        </section>
        <section data-markdown>
          <textarea data-template>
            <h3>Pourquoi est-ce si important ?</h3>
            <p class="fragment fade-up">Parce qu'ils restent en mémoire -> LEAK</p>
            <p class="fragment fade-up">Parce qu'ils provoquent des effets de bord involontaires et dégueulasses</p>
            <p class="fragment fade-up">Ca devient la croix et la bannière pour débugger</p>
            <p class="fragment fade-up">Gonflant à reviewer</p>
          </textarea>
        </section>
        <section data-markdown>
          <textarea>
            <img src="img/degueu.png"></img>
          </textarea>
        </section>
        <section data-markdown>
          <textarea data-template>
            <h3>Du coup....</h3>
            <p class="fragment fade-up">Il est important de réfléchir à sa durée de vie</p>
            <p class="fragment fade-up">En fonction de la réponse à cette question, on utilisera la méthode adéquate pour se désabonner</p>
          </textarea>
        </section>
        <section data-markdown>
          <textarea data-template>
            <h3>Let me show you</h3>
          </textarea>
        </section>
        <section data-markdown>
          <textarea data-template>
            <h3>Opérateur ofRoute</h3>
            <p class="fragment fade-up">S'utilise dans les ngrx/effects</p>
            <p class="fragment fade-up">Ecoute l'action CHANGE dispatché lors d'une navigation</p>
            <p class="fragment fade-up">Se base sur le store du router </p>
            <p class="fragment fade-up">Permet de dispatcher des actions sur une route particulière, en comparant l'URL actuelle</p>
          </textarea>
        </section>
				<section data-markdown>
					<textarea data-template>
						### feature-routing.module.ts
						```
						{
							path: '',
							data: { breadcrumb: new BreadCrumb('circles', BreadCrumbCirclesL10n.circleManagement) },
							children: [
								{
									path: '',
									canActivate: [CirclesGuard],
									component: CircleHomeComponent
								},
								{
									path: ':id',
									canActivate: [CircleDetailGuard],
									canActivateChild: [CircleDetailGuard],
									data: {
										breadcrumb: new BreadCrumb('root-circle', BreadCrumbCirclesL10n.currentCircle)
									},
									children: [
										{
											path: '',
											component: CircleDetailComponent
										},
										{
											path: 'subcircle/:id',
											component: CircleDetailComponent,
											data: {
												breadcrumb: new BreadCrumb('sub-circle', BreadCrumbCirclesL10n.currentSubCircle)
											}
										}
									]
								}
							]
						}
						```
          </textarea>
				</section>
			<section>
				<section data-markdown>
					<textarea data-template>
						### 3. L'état NgRx
						1) Définir l'état de sa fonctionnalité métier

						```
						export interface CirclesListState {
							data: Array<Circle>;
							loading: boolean;
							error: string;
							deleteCircleError: boolean;
							addCircleFormReset: boolean;
						}
						
						const initialState: CirclesListState = {
							data: null,
							loading: false,
							error: '',
							deleteCircleError: false,
							addCircleFormReset: false
						};						
						```
          </textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
							2) Définir les actions + payload
							
							```
							export enum CirclesListActionTypes {
								ADD_CIRCLE = 'ADD_CIRCLE',
								ADD_CIRCLE_SUCCESS = 'ADD_CIRCLE_SUCCESS',
								ADD_CIRCLE_ERROR = 'ADD_CIRCLE_ERROR'
							}

							export class AddCircleAction implements Action {
								readonly type = CirclesListActionTypes.ADD_CIRCLE;
							
								constructor(public payload: Circle) {}
							}
							
							export class AddCircleActionSuccess implements Action {
								readonly type = CirclesListActionTypes.ADD_CIRCLE_SUCCESS;
							
								constructor(public payload: any) {}
							}
							
							export class AddCircleActionError implements Action {
								readonly type = CirclesListActionTypes.ADD_CIRCLE_ERROR;
							
								constructor(public payload: any) {}
							}
							```
						</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
								3) Le reducer
								
								```
								switch (action.type) {
									case CirclesListActionTypes.ADD_CIRCLE:
										return updateCircle(state, { addCircleFormReset: false, loading: true });										
									case CirclesListActionTypes.ADD_CIRCLE_SUCCESS:
										return updateCircle(state, { loading: false, addCircleFormReset: true, data: [...state.data, action.payload] });
									case CirclesListActionTypes.ADD_CIRCLE_ERROR:
										return updateCircle(state, { loading: false, error: action.payload });
									default:
										return state;
								}
								```
							</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
									4) Les effects
									
									```
									@Effect()
  addCircle$: Observable<Action> = this.actions$.pipe(
    ofType(CirclesListActionTypes.ADD_CIRCLE),
    map((action: AddCircleAction) => action.payload),
    switchMap((payload: any) => {
      return this.circleService.createCircle(payload).pipe(
        switchMap((circle: Circle) => [
          new AddCircleActionSuccess(circle),
          new ShowSnackbarAction({
            message: this.translate.instant('circles.homeComponent.circleAdded'),
            action: null,
            config: { duration: 3000 }
          })
        ]),
        catchError((err: any) => of(new AddCircleActionError(err)))
      );
    })
  );
									```
								</textarea>
				</section>
			</section>
			<section>
				<section data-markdown data-notes="Npm enterprise : 20$ / user par mois">
					<textarea data-template>
						### 4. RxJS
						- Librairie pour la programmation réactive utilisant les Observables.
						
						```
						// From one or multiple values
						Observable.of('foo', 'bar');

						// From array of values
						Observable.from([1,2,3]);

						// From an event
						Observable.fromEvent(document.querySelector('button'), 'click');

						// From a Promise
						Observable.fromPromise(fetch('/users'));
						```
          </textarea>
				</section>
				<section data-markdown data-notes="Npm enterprise : 20$ / user par mois">
					<textarea data-template>
						- Souscrire à un Observable
						
						```
						// From array of values
						const src = Observable.from([1,2,3]);

						src.subscribe(
							(value: number) => console.log(`number : ${value}`);
						);
						
						```

						```

						import { filter, map } from 'rxjs/operators';

						const squareOdd = of(1, 2, 3, 4, 5)
							.pipe(
								filter(n => n % 2 !== 0),
								map(n => n * n)
							);

						// Subscribe to get values
						squareOdd.subscribe(x => console.log(x));
						```
          </textarea>
				</section>
				<section data-markdown data-notes="Npm enterprise : 20$ / user par mois">
					<textarea data-template>
						- RxJS est complexe mais puissant

						- RxJS contient un grand nombre d'opérateurs

						- Documentations : 
					
						https://www.learnrxjs.io/
						
						https://rxjs-dev.firebaseapp.com/

						http://rxmarbles.com/

          </textarea>
				</section>
			</section>
			<section>
				<section data-markdown>
					<textarea data-template>
						### 5. Création des pages
						```
						 // Génération du composant avec le ng-cli

						 ng g c modules/circles/pages/circleHomeComponent
						```

						- S'abonner au store NgRx pour récupérer l'état de votre fonctionnalité métier.	
          </textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
							#### Exemple de composant
							```
							export class CircleHomeComponent implements OnInit {
								// circles observable state
								circles$: Observable<Array<Circle>>;
								// All circles loading
								circlesLoading$: Observable<boolean>;
								// Reset circle form state
								addCircleFormReset$: Observable<boolean>;
								// display add form
								isDiplayAddForm: boolean;
							
								constructor(private circleStore: Store<CirclesListState>, private router: Router, private route: ActivatedRoute) {}
							
								ngOnInit(): void {
									this.getCirclesState();
								}
							
								/**
								 * Get circles state properties from the store
								 */
								getCirclesState(): void {
									this.circlesLoading$ = this.circleStore.pipe(select(getAllCirclesLoading));
									this.circles$ = this.circleStore.pipe(
										select(getAllCircles),
										skipUntil(this.circlesLoading$.pipe(filter((loading: boolean) => !loading)))
									);
									this.addCircleFormReset$ = this.circleStore.pipe(select(getAddCircleFormReset));
								}
							```
						</textarea>
				</section>
			</section>
			<section>
				<section data-markdown data-notes="MVP: minimum viable product">
					<textarea data-template>
						### 6. Création des composants stateless		
						
						- Les composants 'Dumb' prennent des paramètres en entréees via le décorator @Input et peuvent émettre des Event Emitter via @Output.	
						
						```
						  // Génération du composant avec le ng-cli

						  ng g c modules/circles/components/circleAddFormComponent
					  ```
          </textarea>
				</section>
				<section data-markdown data-notes="MVP: minimum viable product">
					<textarea data-template>
							#### Exemple de composant 		
							
							```
							export class CircleMemberAddFormComponent extends AbstractCircleForm<CircleCollaborator> implements OnInit, OnDestroy {
									// searched agents
									@Input() searchedMembers: Array<User>;
									@Input() searchedMembersLoading: boolean;
									// agent searched by name
									@Output() memberName: EventEmitter<string> = new EventEmitter();
								
									// member idPeople selected via autocomplete
									memblerIdPeopleSelected: number;
									// rxjs subscription
									nameSubcription: Subscription;
								
									constructor(protected fb: FormBuilder, protected translate: TranslateService) {
										super(fb, translate);
									}
								
									ngOnInit(): void {
										this.searchedMembersLoading = false;
										this.nameSubcription = this.form
											.get('name')
											.valueChanges.pipe(
												debounceTime(500),
												distinctUntilChanged(),
												filter((name: string) => !!name)
											)
											.subscribe((name: string) => {
												!this.memblerIdPeopleSelected && this.memberName.emit(name);
											});
									}
									...
								}
							```
						</textarea>
				</section>
			</section>
			<section>
				<section data-markdown>
					<textarea data-template>
						### 7. Tests unitaires	
						
						Angular propose 3 types de tests :

						- Unit 
						- Integration
						- End to End
          </textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
							### 2 types retenues	

							- Unit : A effectuer pour chaque composant, service, reducer, effect, ations, guard, resolver, directive.

							- End to End : A effectuer pour chaque fonctionnalité métier. Pour l'instant les tests E2E ne sont pas encore près dans notre stack.
						</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
								#### Exemple de test unit	(component class testing)
								
								```
								beforeEach(() => {
									TestBed.configureTestingModule({
										// provide the component-under-test and dependent service
										providers: [
											WelcomeComponent,
											{ provide: UserService, useClass: MockUserService }
										]
									});
									// inject both the component and the dependent service.
									comp = TestBed.get(WelcomeComponent);
									userService = TestBed.get(UserService);
								});

								it('should not have welcome message after construction', () => {
									expect(comp.welcome).toBeUndefined();
								});
								
								it('should welcome logged in user after Angular calls ngOnInit', () => {
									comp.ngOnInit();
									expect(comp.welcome).toContain(userService.user.name);
								});
								
								it('should ask user to log in if not logged in after ngOnInit', () => {
									userService.isLoggedIn = false;
									comp.ngOnInit();
									expect(comp.welcome).not.toContain(userService.user.name);
									expect(comp.welcome).toContain('log in');
								});
								```
							</textarea>
				</section>
				<section data-markdown>
					<textarea data-template>
							##### Les tests liés au DOM seront effectués dans les tests E2E	
	
							Documentation officielle : https://angular.io/guide/testing#component-class-testing
							</textarea>
				</section>
			</section>
			<section data-markdown>
				<textarea data-template>
				 ## Questions ?
        </textarea>
			</section>
		</div>
	</div>

	<script src="lib/js/head.min.js"></script>
	<script src="js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			history: true,
			progress: true,
			slideNumber: true,
			dependencies: [
				{ src: 'plugin/markdown/marked.js' },
				{ src: 'plugin/markdown/markdown.js' },
				{ src: 'plugin/notes/notes.js', async: true },
				{ src: 'plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>
</body>

</html>